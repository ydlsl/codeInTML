{"remainingRequest":"/home/yd/company/demo/vue-cli3/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/yd/company/demo/vue-cli3/src/pc-project/components/select-city.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/home/yd/company/demo/vue-cli3/src/pc-project/components/select-city.vue","mtime":1644831193685},{"path":"/home/yd/company/demo/vue-cli3/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/yd/company/demo/vue-cli3/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/yd/company/demo/vue-cli3/node_modules/ts-loader/index.js","mtime":499162500000},{"path":"/home/yd/company/demo/vue-cli3/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/yd/company/demo/vue-cli3/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKaW1wb3J0IHsgQ29tcG9uZW50LCBWdWUsIFByb3AsIEVtaXQsIE1vZGVsIH0gZnJvbSAndnVlLXByb3BlcnR5LWRlY29yYXRvcic7CmltcG9ydCB7c2VydmljZX0gZnJvbSAnQC9wYy1wcm9qZWN0L3NlcnZpY2VzL2ludGVyZmFjZXMnCmltcG9ydCB7IGdldFBvcywgc3RvcFByb3BhZ2F0aW9uIH0gZnJvbSAnQC91dGlscyc7CgovKioKICogQGluaXQoZXZlbnQ6IGFueSkgIOWIneWni+imgeiwg+eUqOatpOaWueazlQogKiBAbGlzdFN0eWxl5o6n5Yi25b2T5YmN57uE5Lu255qE5L2N572uCiAqIHNlbGVjdGVkIGVtaXTkuovku7YKICovCgpAQ29tcG9uZW50CmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlbGVjdENpdHlDb21wb25lbnQgZXh0ZW5kcyBWdWUgewogIEBNb2RlbCgnY2hhbmdlJywgeyB0eXBlOiBTdHJpbmcgfSkgcmVhZG9ubHkgc2VhcmNoQ29kZSE6IHN0cmluZwoKICBwcml2YXRlIGxpc3RTdHlsZTogYW55ID0geyAncG9pbnRlci1ldmVudHMnOiAnYXV0bycgfTsKICBwcml2YXRlIGNsaWNrYm94U2hvdyA9IGZhbHNlOyAvLyDngrnlh7vpnaLmnb/mmK/lkKbmmL7npLoKICBwcml2YXRlIGlucHV0Ym94U2hvdyA9IGZhbHNlOyAvLyDovpPlhaXpnaLmnb/mmK/lkKbmmL7npLoKICBwcml2YXRlIGFsbENpdHk6IGFueVtdID0gW107IC8vIOaJgOacieWfjuW4ggogIHByaXZhdGUgaW5wdXRBbGxDaXR5OiBhbnlbXSA9IFtdOyAvLyDovpPlhaXnmoTml7blgJnmmL7npLrnmoTliJfooagKICBwcml2YXRlIHNlbGVjdGVkS2V5ID0gJ+eDremXqCc7CiAgcHJpdmF0ZSBob3RDaXR5OiBhbnlbXSA9IFtdOyAvLyDng63pl6jln47luILliJfooagKICBwcml2YXRlIHNwbGl0Q2l0eUxpc3Q6IGFueSA9IHsgLy8gQS1a6Z2i5p2/5YiX6KGoCiAgICAgICdBQkMnOiB7fSwKICAgICAgJ0RFRkcnOiB7fSwKICAgICAgJ0hKJzoge30sCiAgICAgICdLTCc6IHt9LAogICAgICAnTU5QUSc6IHt9LAogICAgICAnUlNUVyc6IHt9LAogICAgICAnWFlaJzoge30sCiAgfQoKICBARW1pdCgnc2VsZWN0ZWQnKSBwcml2YXRlIGNoZWNrTmFtZShpdGVtOiBhbnkpIHsKICAgIHRoaXMuY2xpY2tib3hTaG93ID0gZmFsc2U7CiAgICB0aGlzLmlucHV0Ym94U2hvdyA9IGZhbHNlOwogICAgdGhpcy5jaGFuZ2VFbWl0KGl0ZW0uTmFtZSk7CiAgfQoKICBARW1pdCgnY2hhbmdlJykgcHJpdmF0ZSBjaGFuZ2VFbWl0KGV2ZW50OiBhbnkpIHt9CgogIHB1YmxpYyBpbnB1dEhhbmRsZShldmVudDogYW55KTogdm9pZCB7CiAgICB0aGlzLmNoYW5nZUVtaXQoZXZlbnQudGFyZ2V0LnZhbHVlKTsKICAgIHRoaXMuaW5pdChldmVudCk7CiAgfQoKICBjbGlja0hhbmRsZShldmVudDogYW55KTogdm9pZCB7CiAgICAvLyB0aGlzLmNoYW5nZUVtaXQoZXZlbnQudGFyZ2V0LnZhbHVlKTsKICAgIHRoaXMuaW5pdChldmVudCk7CgogICAgdGhpcy5jbGlja2JveFNob3cgPSBmYWxzZTsKICAgIHNldFRpbWVvdXQoKCk9PnsKICAgICAgc3RvcFByb3BhZ2F0aW9uKGV2ZW50KTsKICAgICAgdGhpcy5jbGlja2JveFNob3cgPSB0cnVlOwogICAgfSwxMDApCiAgICB0aGlzLmlucHV0Ym94U2hvdyA9IGZhbHNlOwogIH0KCiAgY3JlYXRlZCgpIHsKICAgIHNlcnZpY2UucmVxdWVzdCh7CiAgICAgICAgdXJsOiBgL0NpdGllc2AsCiAgICAgICAgZGF0YToge30sCiAgICAgICAgbm90TG9hZGluZzogdHJ1ZQogICAgfSkudGhlbigocmVzOiBhbnkpID0+IHsKICAgICAgdGhpcy5hbGxDaXR5ID0gcmVzOwogICAgICBjb25zdCBhbGxDaXR5TGlzdDogYW55ID0ge307IC8vIOaJgOacieWfjuW4ggogICAgICB0aGlzLmFsbENpdHkuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHsKICAgICAgICBpZihpdGVtLklzSG90KXsKICAgICAgICAgICAgdGhpcy5ob3RDaXR5LnB1c2goaXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBsZXR0ZXIgPSBpdGVtLkFiYnJldmlhdGlvbi5zdWJzdHIoMCwxKTsKICAgICAgICAgIGlmKGl0ZW0uTGV2ZWwgPT09IDEpewogICAgICAgICAgICBpZighYWxsQ2l0eUxpc3RbbGV0dGVyXSl7IGFsbENpdHlMaXN0W2xldHRlcl0gPSBbXSB9OwogICAgICAgICAgICBhbGxDaXR5TGlzdFtsZXR0ZXJdLnB1c2goaXRlbSk7CiAgICAgICAgICB9CiAgICAgIH0pCiAgICAgIAogICAgICBmb3IobGV0IGtleSBpbiBhbGxDaXR5TGlzdCkgewogICAgICAgICAgZm9yKGxldCBrZXkyIGluIHRoaXMuc3BsaXRDaXR5TGlzdCkgewogICAgICAgICAgICBpZihrZXkyLmluZGV4T2Yoa2V5KSE9PS0xKSB7IC8vIOWtmOWcqAogICAgICAgICAgICBpZighdGhpcy5zcGxpdENpdHlMaXN0W2tleTJdW2tleV0pe3RoaXMuc3BsaXRDaXR5TGlzdFtrZXkyXVtrZXldID0gW119CiAgICAgICAgICAgICAgdGhpcy5zcGxpdENpdHlMaXN0W2tleTJdW2tleV0gPSBhbGxDaXR5TGlzdFtrZXldOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgIHRoaXMuY2xpY2tib3hTaG93ID0gZmFsc2U7CiAgICAgIHRoaXMuaW5wdXRib3hTaG93ID0gZmFsc2U7CiAgICB9KQogIH0KCiAgc2VsZWN0KGtleTogc3RyaW5nKSB7CiAgICB0aGlzLnNlbGVjdGVkS2V5ID0ga2V5OwogICAgY29uc29sZS5sb2codGhpcy5zZWxlY3RlZEtleSk7CiAgfQoKICAvLyDniLbnu4Tku7bosIPnlKgKICBpbml0KGV2ZW50OiBhbnkpIHsKICAgIHRoaXMuc2VsZWN0ZWRLZXkgPSAn54Ot6ZeoJzsKICAgIGNvbnN0IGRvbSA9IGV2ZW50LnRhcmdldDsKICAgIGNvbnN0IF9nZXRQb3MgPSBnZXRQb3MoZG9tKTsKICAgIHRoaXMubGlzdFN0eWxlID0gewogICAgICAuLi50aGlzLmxpc3RTdHlsZSwKICAgICAgLy8gJ3dpZHRoJzogYCR7X2dldFBvcy53aWR0aH1weGAsCiAgICAgICdsZWZ0JzogYCR7X2dldFBvcy5sZWZ0fXB4YCwKICAgICAgJ3RvcCc6IGAke19nZXRQb3MudG9wK19nZXRQb3MuaGVpZ2h0fXB4YCwKICAgIH0KCiAgICBpZihldmVudC50eXBlID09PSAnaW5wdXQnKXsKICAgICAgdGhpcy5pbnB1dChkb20udmFsdWUpOwogICAgfQogIH0KCiAgaW5wdXQodmFsdWU6IHN0cmluZykgewogICAgdGhpcy5jbGlja2JveFNob3cgPSBmYWxzZTsKICAgIHRoaXMuaW5wdXRib3hTaG93ID0gdHJ1ZTsKICAgIHRoaXMuaW5wdXRBbGxDaXR5ID0gdGhpcy5hbGxDaXR5LmZpbHRlcigKICAgICAgaXRlbSA9PiBpdGVtLk5hbWUuaW5kZXhPZih2YWx1ZSk9PT0wIHx8IAogICAgICBpdGVtLlBpbnlpbi5pbmRleE9mKHZhbHVlLnRvVXBwZXJDYXNlKCkpPT09MCB8fAogICAgICBpdGVtLkFiYnJldmlhdGlvbi5pbmRleE9mKHZhbHVlLnRvVXBwZXJDYXNlKCkpPT09MAogICAgICApOwogIH0KCiAgYm94RXZlbnQoZXZlbnQ6IGFueSkgewogICAgc3RvcFByb3BhZ2F0aW9uKGV2ZW50KTsKICB9Cn0K"},{"version":3,"sources":["select-city.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"select-city.vue","sourceRoot":"src/pc-project/components","sourcesContent":["<template>\n  <div>\n    <input type=\"text\" \n    :value=\"searchCode\" \n    @input=\"inputHandle($event)\"\n    @click=\"clickHandle($event)\"\n    />\n    <div class=\"select-city\" :style=\"listStyle\" @click=\"boxEvent\">\n      <div v-if=\"(clickboxShow || inputboxShow)&&allCity.length === 0\">加载中...</div>\n\n      <div class=\"click-city\" v-if=\"clickboxShow && allCity.length\">\n        <div class=\"title\">\n          <span class=\"tit\" :class=\"selectedKey === '热门'?'active':''\" @click=\"select('热门')\">热门</span>\n          <span class=\"tit\" :class=\"selectedKey === key?'active':''\" v-for=\"(value,key,index) of splitCityList\" :key=\"index\" @click=\"select(key)\">\n            {{key}}\n          </span>\n        </div>\n        <div class=\"split-box hot\">\n          <template v-if=\"selectedKey === '热门'\">\n            <span class=\"name\" v-for=\"(item, index) of hotCity\" :key=\"index\" @click=\"checkName(item)\">{{item.Name}}</span>\n          </template>\n        </div>\n        <div class=\"split-box\" v-for=\"(value,key,index) of splitCityList\" :key=\"index\">\n          <!-- <div class=\"split-tit\">{{key}}</div> -->\n          <template v-if=\"selectedKey === key\">\n            <div v-for=\"(value1,key1,index1) of value\" :key=\"index1\">\n              <div class=\"letter-box clearFix\">\n                <div class=\"letter-tit\">{{key1}}</div>\n                <div class=\"letter-con\">\n                  <span class=\"name\" v-for=\"(item2,index2) of value1\" :key=\"index2\" @click=\"checkName(item2)\">{{item2.Name}}</span>\n                </div>\n              </div>\n            </div>\n          </template>\n        </div>\n      </div>\n\n      <div class=\"input-city\" v-if=\"inputboxShow && allCity.length\">\n        <div v-if=\"!inputAllCity.length\">暂无更多数据</div>\n        <template v-if=\"inputAllCity.length\">\n          <div class=\"name-item\" v-for=\"(item, index) of inputAllCity\" :key=\"index\"  @click=\"checkName(item)\">{{item.Name}}</div>\n        </template>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { Component, Vue, Prop, Emit, Model } from 'vue-property-decorator';\nimport {service} from '@/pc-project/services/interfaces'\nimport { getPos, stopPropagation } from '@/utils';\n\n/**\n * @init(event: any)  初始要调用此方法\n * @listStyle控制当前组件的位置\n * selected emit事件\n */\n\n@Component\nexport default class SelectCityComponent extends Vue {\n  @Model('change', { type: String }) readonly searchCode!: string\n\n  private listStyle: any = { 'pointer-events': 'auto' };\n  private clickboxShow = false; // 点击面板是否显示\n  private inputboxShow = false; // 输入面板是否显示\n  private allCity: any[] = []; // 所有城市\n  private inputAllCity: any[] = []; // 输入的时候显示的列表\n  private selectedKey = '热门';\n  private hotCity: any[] = []; // 热门城市列表\n  private splitCityList: any = { // A-Z面板列表\n      'ABC': {},\n      'DEFG': {},\n      'HJ': {},\n      'KL': {},\n      'MNPQ': {},\n      'RSTW': {},\n      'XYZ': {},\n  }\n\n  @Emit('selected') private checkName(item: any) {\n    this.clickboxShow = false;\n    this.inputboxShow = false;\n    this.changeEmit(item.Name);\n  }\n\n  @Emit('change') private changeEmit(event: any) {}\n\n  public inputHandle(event: any): void {\n    this.changeEmit(event.target.value);\n    this.init(event);\n  }\n\n  clickHandle(event: any): void {\n    // this.changeEmit(event.target.value);\n    this.init(event);\n\n    this.clickboxShow = false;\n    setTimeout(()=>{\n      stopPropagation(event);\n      this.clickboxShow = true;\n    },100)\n    this.inputboxShow = false;\n  }\n\n  created() {\n    service.request({\n        url: `/Cities`,\n        data: {},\n        notLoading: true\n    }).then((res: any) => {\n      this.allCity = res;\n      const allCityList: any = {}; // 所有城市\n      this.allCity.forEach((item, index) => {\n        if(item.IsHot){\n            this.hotCity.push(item);\n          }\n          const letter = item.Abbreviation.substr(0,1);\n          if(item.Level === 1){\n            if(!allCityList[letter]){ allCityList[letter] = [] };\n            allCityList[letter].push(item);\n          }\n      })\n      \n      for(let key in allCityList) {\n          for(let key2 in this.splitCityList) {\n            if(key2.indexOf(key)!==-1) { // 存在\n            if(!this.splitCityList[key2][key]){this.splitCityList[key2][key] = []}\n              this.splitCityList[key2][key] = allCityList[key];\n            }\n          }\n      }\n    });\n    document.addEventListener(\"click\", () => {\n      this.clickboxShow = false;\n      this.inputboxShow = false;\n    })\n  }\n\n  select(key: string) {\n    this.selectedKey = key;\n    console.log(this.selectedKey);\n  }\n\n  // 父组件调用\n  init(event: any) {\n    this.selectedKey = '热门';\n    const dom = event.target;\n    const _getPos = getPos(dom);\n    this.listStyle = {\n      ...this.listStyle,\n      // 'width': `${_getPos.width}px`,\n      'left': `${_getPos.left}px`,\n      'top': `${_getPos.top+_getPos.height}px`,\n    }\n\n    if(event.type === 'input'){\n      this.input(dom.value);\n    }\n  }\n\n  input(value: string) {\n    this.clickboxShow = false;\n    this.inputboxShow = true;\n    this.inputAllCity = this.allCity.filter(\n      item => item.Name.indexOf(value)===0 || \n      item.Pinyin.indexOf(value.toUpperCase())===0 ||\n      item.Abbreviation.indexOf(value.toUpperCase())===0\n      );\n  }\n\n  boxEvent(event: any) {\n    stopPropagation(event);\n  }\n}\n</script>\n\n<style scoped lang=\"less\">\n.select-city{position: absolute;font-size:12px;box-shadow: 0px 5px 38px #ccc;background:#fff;\n  .click-city{background: #fff;width:290px;}\n  .input-city{background: #fff;width:200px;max-height: 300px;overflow-y: auto;\n    .name-item{padding:3px; cursor: pointer;}\n  }\n  .name{padding:8px;display: inline-block;cursor: pointer;}\n  .title{border-bottom:1px solid #d8d8d8;\n    .tit{padding:0 5px;border-bottom:1px solid #d8d8d8;display:inline-block;line-height:24px;cursor: pointer;\n      position: relative;bottom:-1px;\n      &.active{border:1px solid #ddd;border-bottom:1px solid #fff;}\n    }\n  }\n  .split-box{background: #fff;\n    .letter-tit{float: left;width:20px;text-align: center;color:#ff6e00;padding-top:10px;}\n    .letter-con{float: left;width: 268px;}\n  }\n\n}\n</style>\n\n"]}]}